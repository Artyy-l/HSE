#------------------------------------------------------------------------------------------------
# §¬§à§ß§Ó§Ö§â§ä§Ñ§è§Ú§ñ §ã§ä§â§à§Ü§Ú §Ó §ß§Ñ§ä§å§â§Ñ§Ý§î§ß§à§Ö §é§Ú§ã§Ý§à
# §±§Ñ§â§Ñ§Þ§Ö§ä§â§í:
#    %reg_string - §â§Ö§Ô§Ú§ã§ä§â §ã §Ñ§Õ§â§Ö§ã§à§Þ §ã§ä§â§à§Ü§Ú
#    %reg_int - §â§Ö§Ô§Ú§ã§ä§â §Õ§Ý§ñ §ç§â§Ñ§ß§Ö§ß§Ú§ñ §â§Ö§Ù§å§Ý§î§ä§Ñ§ä§Ñ
.macro string_to_int (%reg_string, %reg_int)
	    li t0 0                   	# t0 §Ò§å§Õ§Ö§ä §ç§â§Ñ§ß§Ú§ä§î §Ú§ä§à§Ô§à§Ó§à§Ö §é§Ú§ã§Ý§à (§Ú§ß§Ú§è§Ú§Ñ§Ý§Ú§Ù§Ñ§è§Ú§ñ §Ó 0)
	    li t1 10                  	# t1 = 10, §Õ§Ý§ñ §å§Þ§ß§à§Ø§Ö§ß§Ú§ñ §á§â§Ú §à§Ò§â§Ñ§Ò§à§ä§Ü§Ö §ã§Ý§Ö§Õ§å§ð§ë§Ö§Û §è§Ú§æ§â§í
	
	convert_loop:  
	    lb t2 (%reg_string)      	# §©§Ñ§Ô§â§å§Ù§Ü§Ñ §ä§Ö§Ü§å§ë§Ö§Ô§à §ã§Ú§Þ§Ó§à§Ý§Ñ §ã§ä§â§à§Ü§Ú §Ó t2
	    beq t2 zero conversion_done  # §¦§ã§Ý§Ú §ã§Ú§Þ§Ó§à§Ý = 0 (null terminator), §Ù§Ñ§Ó§Ö§â§ê§Ú§ä§î
	
	    addi t2 t2 -48            	# §±§â§Ö§à§Ò§â§Ñ§Ù§à§Ó§Ñ§ß§Ú§Ö §ã§Ú§Þ§Ó§à§Ý§Ñ ASCII §Ó §é§Ú§ã§Ý§à§Ó§à§Ö §Ù§ß§Ñ§é§Ö§ß§Ú§Ö
	    blt t2 zero conversion_error # §¦§ã§Ý§Ú t2 < 0, §à§ê§Ú§Ò§Ü§Ñ
	    bge t2 t1 conversion_error   # §¦§ã§Ý§Ú t2 >= 10, §à§ê§Ú§Ò§Ü§Ñ
	
	    mul t0 t0 t1              	# §µ§Þ§ß§à§Ø§Ö§ß§Ú§Ö §ä§Ö§Ü§å§ë§Ö§Ô§à §é§Ú§ã§Ý§Ñ §ß§Ñ 10
	    add t0 t0 t2              	# §¥§à§Ò§Ñ§Ó§Ý§Ö§ß§Ú§Ö §ä§Ö§Ü§å§ë§Ö§Û §è§Ú§æ§â§í
	
	    addi %reg_string %reg_string 1 	# §±§Ö§â§Ö§ç§à§Õ §Ü §ã§Ý§Ö§Õ§å§ð§ë§Ö§Þ§å §ã§Ú§Þ§Ó§à§Ý§å
	    j convert_loop             	# §±§à§Ó§ä§à§â §è§Ú§Ü§Ý§Ñ
	
	conversion_done:
	    mv %reg_int t0            	# §³§à§ç§â§Ñ§ß§Ö§ß§Ú§Ö §â§Ö§Ù§å§Ý§î§ä§Ñ§ä§Ñ §Ó %reg_int
	    j conversion_exit          	# §±§Ö§â§Ö§ç§à§Õ §Ü §Ù§Ñ§Ó§Ö§â§ê§Ö§ß§Ú§ð
	
	conversion_error:
	    li %reg_int -1            	# §µ§ã§ä§Ñ§ß§Ñ§Ó§Ý§Ú§Ó§Ñ§Ö§Þ -1 §Ó §ã§Ý§å§é§Ñ§Ö §à§ê§Ú§Ò§Ü§Ú
	
	conversion_exit:
.end_macro


#------------------------------------------------------------------------------------------------
# §±§Ñ§â§Ñ§Þ§Ö§ä§â§í:
#    %address - §Ñ§Õ§â§Ö§ã §ã§ä§â§à§Ü§Ú
.macro remove_newline (%address)
	# §³§à§ç§â§Ñ§ß§ñ§Ö§Þ §Ñ§Õ§â§Ö§ã §ã§ä§â§à§Ü§Ú §ß§Ñ §ã§ä§Ö§Ü§Ö
	addi sp sp -4
	sw %address 0(sp)
	
	# §±§Ö§â§Ö§ç§à§Õ§Ú§Þ §Ó §á§à§Õ§á§â§à§Ô§â§Ñ§Þ§Þ§å
	jal ra remove_newline
	
	# §£§à§ã§ã§ä§Ñ§ß§Ñ§Ó§Ý§Ú§Ó§Ñ§Ö§Þ §ã§ä§Ö§Ü
	addi sp sp 4
.end_macro

#------------------------------------------------------------------------------------------------
# §£§Ó§à§Õ §ã§ä§â§à§Ü§Ú §Ó §Ò§å§æ§Ö§â §Ù§Ñ§Õ§Ñ§ß§ß§à§Ô§à §â§Ñ§Ù§Þ§Ö§â§Ñ §ã §Ù§Ñ§Þ§Ö§ß§à§Û §á§Ö§â§Ö§Ó§à§Õ§Ñ §ã§ä§â§à§Ü§Ú §ß§å§Ý§Ö§Þ
# %strbuf - §Ñ§Õ§â§Ö§ã §Ò§å§æ§Ö§â§Ñ
# %size - §è§Ö§Ý§Ñ§ñ §Ü§à§ß§ã§ä§Ñ§ß§ä§Ñ, §à§Ô§â§Ñ§ß§Ú§é§Ú§Ó§Ñ§ð§ë§Ñ§ñ §â§Ñ§Ù§Þ§Ö§â §Ó§Ó§à§Õ§Ú§Þ§à§Û §ã§ä§â§à§Ü§Ú
.macro str_get(%strbuf, %size)
    la      a0 %strbuf
    li      a1 %size
    li      a7 8
    ecall
    push(s0)
    push(s1)
    push(s2)
    li	s0 '\n'
    la	s1	%strbuf
next:
    lb	s2  (s1)
    beq s0	s2	replace
    addi s1 s1 1
    b	next
replace:
    sb	zero (s1)
    pop(s2)
    pop(s1)
    pop(s0)
.end_macro

#================================================================================================
# §®§Ñ§Ü§â§à§ã§í §Õ§Ý§ñ §â§Ñ§Ò§à§ä§í §ã §ã§Ú§ã§ä§Ö§Þ§ß§í§Þ§Ú §Ó§í§Ù§à§Ó§Ñ§Þ§Ú
#================================================================================================

#------------------------------------------------------------------------------------------------
# §±§Ö§é§Ñ§ä§î §ã§à§Õ§Ö§â§Ø§Ú§Þ§à§Ô§à §â§Ö§Ô§Ú§ã§ä§â§Ñ §Ü§Ñ§Ü §è§Ö§Ý§à§Ô§à
.macro print_int (%x)
	li a7, 1
	mv a0, %x
	ecall
.end_macro

#------------------------------------------------------------------------------------------------
 .macro print_imm_int (%x)
 li a7, 1
 li a0, %x
 ecall
 .end_macro

#------------------------------------------------------------------------------------------------
# §£§Ó§à§Õ §è§Ö§Ý§à§Ô§à §é§Ú§ã§Ý§Ñ §ã §Ü§à§ß§ã§à§Ý§Ú §Ó §â§Ö§Ô§Ú§ã§ä§â a0
.macro read_int_a0
   li a7, 5
   ecall
.end_macro

#------------------------------------------------------------------------------------------------
# §£§Ó§à§Õ §è§Ö§Ý§à§Ô§à §é§Ú§ã§Ý§Ñ §ã §Ü§à§ß§ã§à§Ý§Ú §Ó §å§Ü§Ñ§Ù§Ñ§ß§ß§í§Û §â§Ö§Ô§Ú§ã§ä§â,
# §Ú§ã§Ü§Ý§ð§é§Ñ§ñ §â§Ö§Ô§Ú§ã§ä§â a0
.macro read_int(%x)
   push	(a0)
   li a7, 5
   ecall
   mv %x, a0
   pop	(a0)
.end_macro

#------------------------------------------------------------------------------------------------
# §£§Ó§à§Õ §ã§Ú§Þ§Ó§à§Ý§Ñ §ã §Ü§à§ß§ã§à§Ý§Ú §Ó §å§Ü§Ñ§Ù§Ñ§ß§ß§í§Û §â§Ö§Ô§Ú§ã§ä§â,
# §Ú§ã§Ü§Ý§ð§é§Ñ§ñ §â§Ö§Ô§Ú§ã§ä§â a0
.macro read_char(%x)
   push	(a0)
   li a7, 12
   ecall
   mv %x, a0
   pop	(a0)
.end_macro

#------------------------------------------------------------------------------------------------
# §±§Ö§é§Ñ§ä§î §ã§ä§â§à§Ü§à§Ó§à§Û §Ü§à§ß§ã§ä§Ñ§ß§ä§í, §à§Ô§â§Ñ§ß§Ú§é§Ö§ß§ß§à§Û §ß§å§Ý§Ö§Ó§í§Þ §ã§Ú§Þ§Ó§à§Ý§à§Þ
.macro print_str(%x)
   .data
str:
   .asciz %x
   .align 2     # §£§í§â§Ñ§Ó§ß§Ú§Ó§Ñ§ß§Ú§Ö §á§Ñ§Þ§ñ§ä§Ú. §£§à§Ù§Þ§à§Ø§ß§í §Õ§Ñ§ß§ß§í§Ö §â§Ñ§Ù§Þ§Ö§â§à§Þ §Ó §ã§Ý§à§Ó§à
   .text
   push (a0)
   li a7, 4
   la a0, str
   ecall
   pop	(a0)
.end_macro

#------------------------------------------------------------------------------------------------
# §±§Ö§é§Ñ§ä§î §ã§ä§â§à§Ü§Ú §á§à §Ñ§Õ§â§Ö§ã§å
.macro print_str_addr(%reg)
   	push(a0)
   	mv a0, %reg
	li 	a7 4
   	ecall
   	pop(a0)
.end_macro

#------------------------------------------------------------------------------------------------
.macro print_char(%x)
   li a7, 11
   li a0, %x
   ecall
.end_macro

#------------------------------------------------------------------------------------------------
# §±§Ö§é§Ñ§ä§î §á§Ö§â§Ö§Ó§à§Õ§Ñ §ã§ä§â§à§Ü§Ú
.macro newline
   print_char('\n')
.end_macro

#------------------------------------------------------------------------------------------------
# §©§Ñ§Ó§Ö§â§ê§Ö§ß§Ú§Ö §á§â§à§Ô§â§Ñ§Þ§Þ§í
.macro exit
    li a7, 10
    ecall
.end_macro

#------------------------------------------------------------------------------------------------
# §³§à§ç§â§Ñ§ß§Ö§ß§Ú§Ö §Ù§Ñ§Õ§Ñ§ß§ß§à§Ô§à §â§Ö§Ô§Ú§ã§ä§â§Ñ §ß§Ñ §ã§ä§Ö§Ü§Ö
.macro push(%x)
	addi	sp, sp, -4
	sw	%x, (sp)
.end_macro

#------------------------------------------------------------------------------------------------
# §£§í§ä§Ñ§Ý§Ü§Ú§Ó§Ñ§ß§Ú§Ö §Ù§ß§Ñ§é§Ö§ß§Ú§ñ §ã §Ó§Ö§â§ê§Ú§ß§í §ã§ä§Ö§Ü§Ñ §Ó §â§Ö§Ô§Ú§ã§ä§â
.macro pop(%x)
	lw	%x, (sp)
	addi	sp, sp, 4
.end_macro

#------------------------------------------------------------------------------------------------
# §ã§é§Ú§ä§í§Ó§Ñ§Ö§ä §Ó§Ö§ë§Ö§ã§ä§Ó§Ö§ß§ß§à§Ö §é§Ú§ã§Ý§à §ã §Ü§Ý§Ñ§Ó§Ú§Ñ§ä§å§â§í §Ú §Ù§Ñ§á§Ú§ã§í§Ó§Ñ§Ö§ä §Ö§Ô§à §Ó §â§Ö§Ô§Ú§ã§ä§â %x
.macro read_double(%x)
	li a7, 7           # §³§Ú§ã§ä§Ö§Þ§ß§í§Û §Ó§í§Ù§à§Ó §Õ§Ý§ñ §é§ä§Ö§ß§Ú§ñ double
    	ecall
    	fmv.d %x, fa0        # §¬§à§á§Ú§â§å§Ö§Þ §Ù§ß§Ñ§é§Ö§ß§Ú§Ö §Ú§Ù f0 §Ó §â§Ö§Ô§Ú§ã§ä§â %x
.end_macro

#------------------------------------------------------------------------------------------------
# §á§Ö§é§Ñ§ä§Ñ§Ö§ä §é§Ú§ã§Ý§à §ä§Ú§á§Ñ double §Ú§Ù §â§Ö§Ô§Ú§ã§ä§â§Ñ %x
.macro print_double(%x)
	li a7, 3
    	fmv.d fa0, %x       # §¬§à§á§Ú§â§å§Ö§Þ §Ù§ß§Ñ§é§Ö§ß§Ú§Ö §Ú§Ù §â§Ö§Ô§Ú§ã§ä§â§Ñ %x §Ó f12 §Õ§Ý§ñ §á§Ö§é§Ñ§ä§Ú
    	ecall
.end_macro

#------------------------------------------------------------------------------------------------
# §ã§à§ç§â§Ñ§ß§ñ§Ö§ä §Ó §â§Ö§Ô§Ú§ã§ä§â %z §Þ§Ñ§Ü§ã§Ú§Þ§å§Þ §Ú§Ù §Õ§Ó§å§ç double'§à§Ó §Ó §â§Ö§Ô§Ú§ã§ä§â§Ñ§ç %x §Ú %y
.macro max(%x, %y, %z)
	flt.d t0, %x, %y       # §³§â§Ñ§Ó§ß§Ú§Ó§Ñ§Ö§Þ %x §Ú %y. t0 = 1, if %x < %y
    	fmv.d %z, %x           # §¦§ã§Ý§Ú t0 = 0, §ä§à§Ù§Ñ§á§Ú§ã§í§Ó§Ñ§Ö§Þ %x §Ó %z
    	beqz t0, end          # §¦§ã§Ý§Ú %x >= %y (t0 = 0), §á§â§à§á§å§ã§Ü§Ñ§Ö§Þ §ã§Ý§Ö§Õ§å§ð§ë§å§ð §Ú§ß§ã§ä§â§å§Ü§è§Ú§ð
    	fmv.d %z, %y           # §¦§ã§Ý§Ú %x < %y, §Ù§Ñ§á§Ú§ã§í§Ó§Ñ§Ö§Þ %x §Ó %z
end:                          # §®§Ö§ä§Ü§Ñ §Ü§à§ß§è§Ñ §Þ§Ñ§Ü§â§à§ã§Ñ
.end_macro